---
title: Constraints
description: Rules that policies enforce
---

# Constraints

**Constraints** are the individual rules within a policy. Each constraint defines a single condition that must be satisfied.

## Constraint Structure

```typescript
type Constraint = {
  type: string;
  value: unknown;
  message?: string;
  severity?: 'error' | 'warning';
};
```

## Built-in Constraint Types

### max_percentage

Caps the total discount as a percentage of the original price.

```typescript
{
  type: 'max_percentage',
  value: 50,
  message: 'Discount cannot exceed 50%'
}
```

### max_absolute

Caps the total discount as an absolute amount.

```typescript
{
  type: 'max_absolute',
  value: 100,
  message: 'Discount cannot exceed $100'
}
```

### exclude_category

Prevents discounts on specific product categories.

```typescript
{
  type: 'exclude_category',
  value: 'clearance',
  message: 'Clearance items are not eligible for discounts'
}
```

### require_minimum

Requires a minimum cart value before discounts apply.

```typescript
{
  type: 'require_minimum',
  value: 50,
  message: 'Minimum purchase of $50 required'
}
```

### limit_stacking

Limits how many discounts can stack together.

```typescript
{
  type: 'limit_stacking',
  max: 2,
  message: 'Maximum 2 discounts can be combined'
}
```

### time_window

Restricts discounts to specific time periods.

```typescript
{
  type: 'time_window',
  start: '2024-11-28T00:00:00Z',
  end: '2024-12-02T23:59:59Z',
  message: 'This promotion is only valid during Black Friday weekend'
}
```

## Custom Constraints

Register custom constraint handlers:

```typescript
import { registerConstraint } from '@guardrail-sim/core';

registerConstraint('vip_only', (constraint, context) => {
  if (!context.customer?.isVip) {
    return {
      satisfied: false,
      message: constraint.message ?? 'This discount is for VIP members only',
    };
  }
  return { satisfied: true };
});
```

## Constraint Evaluation Order

Constraints are evaluated in order:

1. Time-based constraints (fail fast if outside window)
2. Eligibility constraints (customer, category)
3. Value constraints (min/max limits)
4. Stacking constraints (combination rules)
